# Task 003 — Renderer Worker Refactor to API Polling

Objective: Replace DB polling with API-driven polling, claims, heartbeats, and status updates. Concurrency-limited worker with robust backoff, timeouts, and heartbeats.

Implementation Steps
- [ ] Read API_BASE_URL and API_AUTH_TOKEN from env; validate on start; log start config (masked).
- [ ] Poll GET /api/render-jobs at POLL_INTERVAL_MS with jitter; log queue_depth each tick.
- [ ] For each returned job up to MAX_CONCURRENT, call POST /claim and start processing upon success.
- [ ] During processing, heartbeat every 10s; handle 410/409 by aborting & returning job to queue.
- [ ] Time out jobs after JOB_TIMEOUT_SEC (kill children; mark errored).

Observability
- [ ] JSON logs: start, poll, claim, heartbeat, done, error, including correlation ids.
- [ ] On error include exit code, error class, message, stderr snippet (if available).

Tests
- [ ] Unit: jitter/backoff schedule returns sane values.
- [ ] Integration: mock API returns queued jobs; worker processes and posts status.
- [ ] Integration: simulate heartbeat failure & timeouts → job marked errored.

Acceptance Criteria
- [ ] Worker processes N jobs concurrently with leases respected.
- [ ] Under transient 5xx, backoff applies; under 4xx (except 409), job fails fast.
