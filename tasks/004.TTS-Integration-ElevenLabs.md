# Task 004 â€” TTS Integration (ElevenLabs)

Objective: Generate per-part voice-over using ElevenLabs TTS from part text, cache results, and produce vo.wav for downstream steps.

Environment
- ELEVENLABS_API_KEY
- ELEVENLABS_VOICE_ID
- ELEVENLABS_MODEL_ID (optional; default eleven_multilingual_v2)
- TTS_CACHE_DIR (optional)

Implementation Steps
- [ ] Add TTS client module with retry/backoff and 429 handling; mask API key in logs.
- [ ] Deterministic cache key: sha256(storyId|partId|voiceId|modelId|text).wav in TTS_CACHE_DIR.
- [ ] If cached, skip API call; log cache_hit true/false.
- [ ] Output vo.wav at 44.1k/48kHz PCM; validate with ffprobe and log duration.
- [ ] Config knobs: speaking style/speed (if supported); document defaults.

Tests
- [ ] Unit: cache key generation stable for identical inputs.
- [ ] Integration (mock): returns a known wav; verify file written and reused on second run.
- [ ] Failure: 401/429/5xx cause backoff; logs redact secrets.

Acceptance Criteria
- [ ] TTS audio generated or reused from cache deterministically.
- [ ] Rate limits respected; no secret printed; duration logged.
