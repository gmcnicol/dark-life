# Task 007 — FFmpeg Safety & Atomic Output

Objective: Build explicit ffmpeg command, capture errors, and guarantee atomic final writes.

Implementation Steps
- [ ] Build argv with explicit maps:
      -framerate <fps> -pattern_type glob -i "<frames_glob>" -i "<audio>" -c:v libx264 -pix_fmt yuv420p -c:a aac -b:a 192k -shortest -map 0:v:0 -map 1:a:0 "<tmp_out>"
- [ ] subprocess.run(..., capture_output=True, text=True, check=True); on failure, log exit code + stderr snippet.
- [ ] Write to {OUTPUT_DIR}/.tmp/<name>.mp4, fsync, atomic rename to {OUTPUT_DIR}/<name>.mp4.
- [ ] On DEBUG, set FFREPORT=file=/tmp/ffreport-{job_id}.log:level=32 and log the path.

Tests
- [ ] Integration: missing frames or audio → preflight fails (no ffmpeg invoked).
- [ ] Integration: bad audio causes non-zero exit; stderr captured and included in error status.
- [ ] File system: final output exists only with non-zero size; no orphan tmp files remain.

Acceptance Criteria
- [ ] ffmpeg failures never appear as silent successes; error data present in API status.
- [ ] Outputs are atomically written and durable.
