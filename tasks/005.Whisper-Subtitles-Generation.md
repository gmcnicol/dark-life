# Task 005 â€” Whisper Subtitles Generation (ASR)

Objective: Produce SRT/VTT subtitles by transcribing the generated TTS audio (vo.wav) using Whisper. Ensure timestamps align with final VO.

Environment
- WHISPER_MODEL (tiny|base|small|medium|large)
- WHISPER_DEVICE (cpu|cuda)
- SUBTITLES_FORMAT (srt|vtt)
- SUBTITLES_BURN_IN (true|false)

Implementation Steps
- [ ] Transcribe {TMP_DIR}/{job_id}/vo.wav with Whisper; create {part}.{srt|vtt}.
- [ ] If SUBTITLES_BURN_IN=true, render overlay; else ship sidecar file.
- [ ] Normalize punctuation/casing and merge very short segments (<300ms) for readability.
- [ ] Log number of segments and total subtitle duration; warn if drift > 1s vs VO.

Tests
- [ ] Unit: formatters produce valid SRT/VTT (basic parser).
- [ ] Integration: synthetic short wav (beeps) yields expected segment count.
- [ ] Drift detection triggers warning logs on deliberate skew.

Acceptance Criteria
- [ ] Subtitles exist for every rendered part, matching VO duration within 1s.
- [ ] Burn-in respected when enabled; sidecar otherwise.
